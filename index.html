<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste Dynamique CSV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; cursor: pointer; }
        th { background-color: #f4f4f4; }
        #message { font-weight: bold; margin-top: 20px; }
        #searchInput { margin-top: 10px; padding: 5px; width: 100%; font-size: 16px; }
    </style>
</head>
<body>

    <h1>Inventaire</h1>
    
    <p>Stock au 12/03/2025</p>
    
    <p>Vous pouvez cliquer sur l'entête des colonnes pour trier les données. Pour trier par pictogrammes de sécurité, veuillez rechercher SGH.. (SGH01 pour explosif, 02 inflammable, 03 comburant, 05 corrosif, 06 mortel, 07 nocif, 08 cancérogène et 09 environnement)</p>
    
    <input type="text" id="searchInput" placeholder="Rechercher...">

    <table id="csvTable">
        <thead>
            <tr id="tableHeader"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        let data = [];
        let filteredData = [];
        let sortAscending = true;
        const csvUrl = "https://raw.githubusercontent.com/Gestionlabo/gestionlabo/refs/heads/main/data.csv"; 

        const pictograms = {
            "SGH07": "https://upload.wikimedia.org/wikipedia/commons/c/c3/GHS-pictogram-exclam.svg",
            "SGH04": "https://upload.wikimedia.org/wikipedia/commons/6/6a/GHS-pictogram-bottle.svg",
            "SGH01": "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/GHS-pictogram-explos.svg/100px-GHS-pictogram-explos.svg.png",
            "SGH02": "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/GHS-pictogram-flamme.svg/100px-GHS-pictogram-flamme.svg.png",
            "SGH03": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/GHS-pictogram-rondflam.svg/100px-GHS-pictogram-rondflam.svg.png",
            "SGH05": "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/GHS-pictogram-acid.svg/100px-GHS-pictogram-acid.svg.png",
            "SGH06": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/58/GHS-pictogram-skull.svg/100px-GHS-pictogram-skull.svg.png",
            "SGH08": "https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/GHS-pictogram-silhouette.svg/100px-GHS-pictogram-silhouette.svg.png",
            "SGH09": "https://upload.wikimedia.org/wikipedia/commons/b/b9/GHS-pictogram-pollu.svg?uselang=fr"
        };

        function chargerCSV() {
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    Papa.parse(csvText, {
                        delimiter: ";",
                        header: true,
                        complete: (result) => {
                            data = result.data;
                            filteredData = [...data];
                            afficherTableau();
                        }
                    });
                })
                .catch(error => console.error('Erreur de chargement CSV:', error));
        }

        function afficherTableau() {
            const tableHeader = document.getElementById("tableHeader");
            const tableBody = document.getElementById("tableBody");

            tableHeader.innerHTML = "";
            tableBody.innerHTML = "";

            if (filteredData.length === 0) return;

            // Créer les entêtes de colonnes
            Object.keys(filteredData[0]).forEach(colonne => {
                const th = document.createElement("th");
                th.textContent = colonne;
                if (colonne !== "Nom produit") { // Ne pas ajouter de tri pour la colonne 3
                    th.onclick = () => trierColonne(colonne);
                }
                tableHeader.appendChild(th);
            });

            // Ajouter les lignes
            filteredData.forEach(ligne => {
                const tr = document.createElement("tr");
                Object.entries(ligne).forEach(([colonne, valeur], index) => {
                    const td = document.createElement("td");

                    // Traitement des pictogrammes SGH
                    if (index === 6) {
                        td.innerHTML = "";
                        const pictos = valeur.split(" ");
                        pictos.forEach(picto => {
                            if (pictograms[picto]) {
                                const img = document.createElement("img");
                                img.style.width = "45px";
                                img.src = pictograms[picto];
                                img.alt = `Pictogramme ${picto}`;
                                td.appendChild(img);
                            }
                        });
                    } else {
                        td.textContent = valeur;
                    }

                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        function trierColonne(colonne) {
            const index = Object.keys(filteredData[0]).indexOf(colonne);
            const isNumeric = [3, 5, 7].includes(index);

            filteredData.sort((a, b) => {
                let valA = a[colonne] || "";
                let valB = b[colonne] || "";

                // Si la colonne contient des nombres (comme les colonnes 4, 6, 8)
                if (isNumeric) {
                    valA = parseFloat(valA) || 0;
                    valB = parseFloat(valB) || 0;
                    return valA - valB;
                }

                // Si la colonne contient des chaînes (en particulier pour la colonne 2)
                if (index === 1) {
                    const regex = /(\d+)(.*)/; // Expression régulière pour extraire les chiffres
                    const matchA = valA.match(regex);
                    const matchB = valB.match(regex);

                    // Comparaison numérique au début de la chaîne
                    if (matchA && matchB) {
                        const numA = parseInt(matchA[1], 10);
                        const numB = parseInt(matchB[1], 10);
                        if (numA !== numB) {
                            return numA - numB;
                        }
                    }
                }

                // Comparaison lexicographique si les valeurs sont égales
                return valA.localeCompare(valB);
            });

            // Inverser l'ordre de tri à chaque clic
            if (sortAscending) {
                filteredData.reverse();
            }
            sortAscending = !sortAscending;

            afficherTableau();
        }

        document.getElementById("searchInput").addEventListener("input", function(event) {
            const searchTerm = event.target.value.toLowerCase();
            filteredData = data.filter(row => Object.values(row).some(value => value.toString().toLowerCase().includes(searchTerm)));
            afficherTableau();
        });

        window.onload = chargerCSV;
    </script>

</body>
</html>
