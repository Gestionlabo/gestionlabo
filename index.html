<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste Dynamique CSV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; cursor: pointer; }
        th { background-color: #f4f4f4; }
        th.sorted-asc::after { content: " ðŸ”¼"; }
        th.sorted-desc::after { content: " ðŸ”½"; }
        #message { font-weight: bold; margin-top: 20px; }
        #searchInput { margin-top: 10px; padding: 5px; width: 100%; font-size: 16px; }
    </style>
</head>
<body>

    <h1>Inventaire</h1>
    
    <p>Stock au 12/03/2025</p>
    
    <p>Vous pouvez cliquer sur l'entÃªte des colonnes pour trier les donnÃ©es.</p>
    
    <input type="text" id="searchInput" placeholder="Rechercher...">

    <table id="csvTable">
        <thead>
            <tr id="tableHeader"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        let data = [];
        let filteredData = [];
        let sortColumn = null;
        let sortAscending = true;

        // Charger le fichier CSV depuis GitHub
        const csvUrl = "https://raw.githubusercontent.com/Gestionlabo/gestionlabo/refs/heads/main/data.csv"; // Remplace par ton URL

        // Fonction pour charger et afficher les donnÃ©es CSV
        function chargerCSV() {
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    Papa.parse(csvText, {
                        delimiter: ";",
                        header: true,
                        complete: function(result) {
                            data = result.data;
                            filteredData = [...data];
                            afficherTableau();
                        }
                    });
                })
                .catch(error => console.error('Erreur de chargement CSV:', error));
        }

       // Afficher les donnÃ©es dans un tableau HTML
function afficherTableau() {
    const tableHeader = document.getElementById("tableHeader");
    const tableBody = document.getElementById("tableBody");

    tableHeader.innerHTML = "";
    tableBody.innerHTML = "";

    if (filteredData.length === 0) return;

    // GÃ©nÃ©rer les en-tÃªtes de colonnes
    Object.keys(filteredData[0]).forEach((colonne, index) => {
        const th = document.createElement("th");
        th.textContent = colonne;
        th.onclick = () => trierColonne(index, colonne);
        tableHeader.appendChild(th);
    });

    // GÃ©nÃ©rer les lignes du tableau
    filteredData.forEach(ligne => {
        const tr = document.createElement("tr");
        
        Object.entries(ligne).forEach(([colonne, valeur], index) => {
            const td = document.createElement("td");

            // Si la valeur de la colonne 4 (index 3) est "SGH07", afficher l'image
            if (index === 7 && valeur === "SGH07") {
                const img = document.createElement("img");
                img.src = "https://upload.wikimedia.org/wikipedia/commons/c/c3/GHS-pictogram-exclam.svg";
                img.alt = "Pictogramme SGH07";
                img.style.width = "30px"; // Ajuste la taille de l'image si nÃ©cessaire
                td.appendChild(img);
            } else {
                td.textContent = valeur;  // Sinon, afficher la valeur du texte
            }

            tr.appendChild(td);
        });

        tableBody.appendChild(tr);
    });
}


       // Trier les colonnes
function trierColonne(index, colonne) {
    if (sortColumn === colonne) {
        sortAscending = !sortAscending;
    } else {
        sortColumn = colonne;
        sortAscending = true;
    }

    filteredData.sort((a, b) => {
        const valA = a[colonne];
        const valB = b[colonne];

        // Convertir en nombre si possible
        const numA = isNaN(valA) ? valA : parseFloat(valA);
        const numB = isNaN(valB) ? valB : parseFloat(valB);

        if (numA < numB) return sortAscending ? -1 : 1;
        if (numA > numB) return sortAscending ? 1 : -1;
        return 0;
    });

    afficherTableau();
}


        // Fonction de recherche
        document.getElementById("searchInput").addEventListener("input", function(event) {
            const searchTerm = event.target.value.toLowerCase();
            filteredData = data.filter(row => {
                return Object.values(row).some(value =>
                    value.toString().toLowerCase().includes(searchTerm)
                );
            });
            afficherTableau();
        });

        // Charger le CSV dÃ¨s que la page est prÃªte
        window.onload = chargerCSV;
    </script>

</body>
</html>
